<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<script type="text/javascript" src="/bjc-r/llab/loader.js"></script>
		<title>Unit 4 Lab 5: Data Representation and Compression, Page 8</title>
	</head>

	<body>
		<h2>Data Compression</h2>
        <div class="todo">
            I reviewed the page and cut back on the text, including by hinting stuff and dropping redundant vocab boxes. But overall, I find this page tough to get through. I think this is a case where we've tried to do too much and have obscured the point. --MF, 8/7/19
        </div>
        
		<div class="learn"><strong>On this page,</strong> you learn about different <em>data compression algorithms</em>, such as the ones used in common picture file formats.</div>
		<div class="todo">Snap<i>!</i> 5.0 includes support for image processing, pixel by pixel, reasonably fast.  Students could definitely implement run length encoding, and might be able to implement lossy algorithms, although not jpg or gif.  But, for example, turning every 2x2 array of pixels into its average color.  We really should consider this as a way to get some of the beauty and joy back. --BH</div>
        <img class="imageRight" src="/bjc-r/img/6-computers/bjc-logo-original.png" alt="BJC logo uncompressed" title="BJC logo uncompressed" />
		<p>The picture of the BJC logo (at right) is 158 pixels wide and 186 pixels tall, for a total of 29,388 pixels. The BMP (bitmap) format includes each of those pixels in the picture file, at four bytes per pixel, so the file size is about 120kB.</p>
        
		<h3>Lossless Compression</h3>
		<p>That is an inefficient way to store the information. Think about the 158 pixels in the top row. The first 60 or so are white. Then come five pixels of yellowish orange (the top slice of the "b"). And the rest of that row is white.</p>
        <p class="indent">...<img src="/bjc-r/img/6-computers/top-row-of-pixels-in-bjc-logo.png" alt="top-row-of-pixels-in-bjc-logo: 4 white, 6 yellow-orange, 3 white" title="top-row-of-pixels-in-bjc-logo: 4 white, 6 yellow-orange, 3 white">...</p>
        <div class="comment">DAT-1.D.1</div>
        <p>Instead of storing all 158 pixels individually, we could compress them with <em>run-length encoding</em> and just store six values (three numbers and three colors):</p>
        
        <div class="sidenote">Run-length encoding stores the length of each run of a single color.</div>
        <table class="byte indent" width="30%" summary="run length encoding for top row of BJC logo">
            <tr>
                <th width="47%" scope="col">pixel count</th>
                <th width="53%" scope="col">color code</th>
            </tr>
            <tr>
                <td>60</td>
                <td>FFFFFF</td>
            </tr>
            <tr>
                <td>5</td>
                <td bgcolor="E5A84A">E5A84A</td>
            </tr>
            <tr>
                <td>93</td>
                <td>FFFFFF</td>
            </tr>
        </table>

        <p>These days, the size of one picture isn't so significant, but think about every frame of a movie and the time required to send that information over the Internet. Compression makes it easier to stream that movie to you.</p>
		
        <div class="todo">I made this an ITIT because these problems feel only tangentially related to the page. --MF, 8/7/19</div>
        <div class="ifTime">
            <ol>
                <li>Open Snap<em>!</em>. Import the "Set RGB or HSV pen color" Library from the File menu. Using the <img class="inline nopadtb" src="/bjc-r/img/blocks/set-pen-color-rgb.png" alt="set pen color to r:(255) g: (0) b: (0)" title="set pen color to r:(255) g: (0) b: (0)" /> block, determine what happens to the sprite's color if you set the red (r) and green (g) inputs to the maximum value (255) and the blue (b) to 0.</li>
                <div class="endnote">If you want to see the sprite's color more easily, increase its size using <img class="" src="/bjc-r/img/blocks/set-size-empty.png" alt="set size to ( ) %" title="set size to ( ) %" />.</div>
                <li>What if the green is only half as much?</li>
            </ol>
        </div>
        
        <div class="todo">Possible quizlet for LO: (include picture with fairly thin diagonal lines) A student proposes to use run-length encoding to compress this picture. Is that a good idea, why or why not? --MF, 12/16/18<p>I think this would be a much better FYTD although it needs some support so students actually get the idea. I would have done it, but my attempts to use snap to generate such an image failed perhaps due to some weird snap graphic stuff? --MF, 8/7/19</p></div>
        
        <div class="comment">DAT-1.D.2, DAT-1.D.3, DAT-1.D.4</div>
		<!--<div class="vocab">
        	<p><strong>Lossless compression</strong> means that <em>no</em> information is lost.</p>
        </div>-->
        <p>Run-length encoding is a <em>lossless compression</em> format; it doesn't lose any information. The original picture can be precisely reconstructed. But run-length encoding isn't good for images where many pixels are even slightly different in color from its neighbors. If the length of each color run is just one pixel, encoding both run length and color will take <em>twice</em> as much space as just storing the color of each pixel. Another lossless image format you may have heard of is PNG (Portable Network Graphics, pronounced "ping").</p>
            
        <div class="endnote">The PNG algorithm is complicated and uses several different strategies depending on how color varies in each small chunk of the image. The thing to remember is that PNG is lossless.</div>	

        <h3>Lossy Compression</h3>
        
        <!--<div class="vocab">
        	<p><strong>Lossy compression</strong> means that <em>some</em> information is lost.</p>
        </div>-->
    
        <div class="comment">DAT-1.D.7, DAT-1.D.8</div>
        <p><em>Lossy compression</em> algorithms let file sizes be even smaller, but the original picture can't be perfectly reconstructed; information is lost. This would be a poor choice for compressing a computer program or a novel, but images (as well as sounds and movies) do not require precision.</p>
        <p>The most commonly used lossy compression algorithm for pictures is called JPEG (or JPG, both pronounced "jay peg" for "Joint Photographic Experts Group," the committee that invented it). Lossy algorithms usually let you <em>control the degree of precision</em>. </p>
        
        <p>
            Below are an original, uncompressed BMP and a highly compressed JPG of a picture measuring 256Ã—192 pixels. Can you tell which is which?<br />
            <img class="indent" src="/bjc-r/img/6-computers/pond.bmp" alt="pond pebbles" title="pond pebbles" />
            <img src="/bjc-r/img/6-computers/pond.jpg" alt="pond pebbles" title="pond pebbles" />
        </p>
                        
        <div class="comment">DAT-1.D.3, DAT-1.D.6</div>
        <p>
            Here are the sizes of this picture in four different formats:
            <table class="byte indent" width="56%" summary="compression factors example">
                <tr>
                    <th scope="col">format</th>
                    <th scope="col">size</th>
                </tr>
                <tr>
                    <td style="text-align: left;">BMP encoding every pixel individually (shown above)</td>
                    <td>148 kB</td>
                </tr>
                <tr>
                    <td style="text-align: left;">PNG</td>
                    <td>106 kB</td>
                </tr>
                <tr>
                    <td style="text-align: left;">JPEG with least compression</td>
                    <td>94 kB</td>
                </tr>
                <tr>
                    <td style="text-align: left;">JPEG with most compression (shown above)</td>
                    <td>5 kB</td>
                </tr>
            </table>
        </p>
        <div class="comment">DAT-1.D.5</div>
        <p>You probably <em>could</em> tell which is which, especially if you looked for sharp edges, or very shiny spots.  But the compressed file uses 1/30th of the space used by the original!  And you could certainly tell that it's a picture of rocks; for many purposes it'd be good enough.  Mostly, though, people select less extreme compression settings, so the compressed file might be 4/5 the size of the original, and look much more like the lossless version.</p>
		<div class="comment">This was called "most-compression" but since we don't explain what we mean by that (and I don't think we should try to), it's clearer to say "high-compression." --MF, 8/7/19</div>
        <p>
            Here's a high-compression JPEG of the BJC logo:<br />
            <img class="indent" src="/bjc-r/img/4-internet/bjc-logo-jpeg.jpg" alt="pixelated copy of BJC logo" title="pixelated copy of BJC logo" /><br />
            As you can see, the distortion from the lossy compression is much more noticeable when the original picture has sharp edges and solid colors.  (Even so, a less severe JPEG compression doesn't look nearly this bad.)
        </p>
        
        <div class="vocabFullWidth"><strong>: Lossy vs. Lossless</strong>
            <ul>
                <li><strong>Lossless</strong> compression (like PNG) is <em>reversible</em> (no loss in quality); you can reconstruct the original data. It works by removing redundant data.</li>
                <li><strong>Lossy</strong> compression (like JPG) is <em>not</em> fully reversible; you can only reconstruct an <em>approximation</em> of the original data. It works by removing details that people aren't likely to notice. </li>
            </ul>
        </div>

		<div class="endnote">
            <p><a href="#hint-simpler" data-toggle="collapse" title="Are there simpler ways to do lossy compression?">Are there simpler ways to do lossy compression?</a></p>
            <div id="hint-simpler" class="collapse">
                <p>
                    JPEG encoding is a complicated algorithm, but we can experiment with a simpler lossy compression algorithm:  Divide the picture into 2-by-2 squares of four pixels.  Then average the four pixels in each square.  The result is a smaller picture:<br />
                    <img class="indent" src="/bjc-r/img/4-internet/small-stones.png" alt="pond pebbles, half the size or original image" title="pond pebbles, half the size or original image" /><br />
                    Since the smaller costume has 1/4 as many pixels, it has about 25% the size of the original.  Now we can decompress the picture by replacing each pixel with a 2-by-2 square of identical pixels:<br />
                    <img class="indent" src="/bjc-r/img/4-internet/restored-stones.png" alt="pond pebbles, blown up to full size from half size image" title="pond pebbles, blown up to full size from half size image" /><br />
                    The picture is still recognizably rocks, but it's even fuzzier than the lossy JPEG.  That's not surprising, since the compression technique is much simpler than JPEG.
                </p>        
            </div>
        </div>

        <div class="todo">BH idea: We could do a FYTD where they have to run-length encode/decode something. Maybe even encoding/decoding images in Snap. --MF, 11/8/17</div>

        <div class="forYouToDo">
			<ol start="3">
				<div class="todo">This question is cute, but I don't see what it offers us... --MF, 8/7/19</div>
                <li>
					"If u cn rd ths u cn gt a gd jb w hi pa!"  This was the headline of an advertisement in the subway many years ago, for a shorthand system called Speedwriting.
					<ol type="a">
						<li>
							What does the headline mean?  Write it down.
						</li>
						<li>
							How effective is Speedwriting as a compression algorithm?  That is, what fraction of the size of the full text is the size of the shorthand text?  (Just count letters, not the spaces between words, which don't take time to write.)
						</li>
						<li>
							<img class="inline" src="/bjc-r/img/icons/talk-with-your-partner.png" alt="Talk with Your Partner" title="Talk with Your Partner" />
                            Is this an example of lossy or lossless compression?  Why?  (This is <em>not</em> an obvious question.)
						</li>
					</ol>
				</li>
				<li>
                    These questions are similar to those you will see on the AP CSP exam.
                    <!-- Question 1 -->
                    <div class="assessment-data" type="multiplechoice" identifier="Which is NOT an explanation of low image quality?" hasinlinefeedback="true" maxchoices="1" responseIdentifier="ri1" shuffle="false">
                        <div class="prompt">A film student records a movie on his smartphone and then saves a copy on his computer. He notices that the saved copy is of much lower image quality than the original. Which of the following could <strong>NOT</strong> be a possible explanation for the lower image quality?</div>
                        <div class="choice" identifier="c1">
                            <div class="text">The movie was saved using fewer bits per second (a lower bitrate) than the original movie.</div>
                            <div class="feedback">This is likely what happened. Which one could NOT be a possible explanation?</div>
                        </div>
                        <div class="choice" identifier="c2">
                            <div class="text">The copy of the movie file was somehow corrupted in the process of saving.</div>
                            <div class="feedback">This is possible; however if the file is corrupted, it is unlikely to have a consistent negative impact on image quality. </div>
                        </div>
                        <div class="choice" identifier="c3">
                            <div class="text">The movie was saved using a lossy compression technique.</div>
                            <div class="feedback">This is very likely. Which one could NOT be a possible explanation?</div>
                        </div>
                        <div class="choice" identifier="c4">
                            <div class="text">Whenever a file is saved from one computer to another, some information is always lost.</div>
                            <div class="feedback">Correct. It is possible to make exact duplicates of digital information without any loss.</div>
                        </div>
                        <div class="responseDeclaration" identifier="ri1">
                            <div class="correctResponse" identifier="c4"></div>
                        </div>
                    </div>
                    
                    <!-- Question 2 -->
                    <div class="assessment-data" type="multiplechoice" identifier="Which are examples of lossless transformation?"
                        hasinlinefeedback="true" maxchoices="2" responseIdentifier="ri2" shuffle="true">
                        <div class="prompt">A visual artist is processing a digital image.  Which of the following describe a <strong>lossless</strong> transformation from which the original image can be recovered? <em>Choose two answers.</em></div>
                        <div class="choice" identifier="c1">
                            <div class="text">Creating the negative of an image, where colors are reversed (dark areas appear light).</div>
                            <div class="feedback">Correct. This transformation is reversible and is an example of a lossless transformation.</div>
                        </div>
                        <div class="choice" identifier="c2">
                            <div class="text">Blurring the edges of an image.</div>
                            <div class="feedback">The blurring blends colors at the edges of the image and once colors have blended it is impossible to retrieve the original RGB values of the pixels involved.</div>
                        </div>
                        <div class="choice" identifier="c3">
                            <div class="text">Creating a grayscale copy of an image.</div>
                            <div class="feedback">The grayscale of an image replaces each RGB value with their average and once the amounts of red, green, and blue have been averaged together, it is impossible to retrieve the original RGB values of the pixels.</div>
                        </div>
                        <div class="choice" identifier="c4">
                            <div class="text">Creating a vertically flipped copy of the image.</div>
                            <div class="feedback">Correct. This transformation is reversible and is an example of a lossless transformation.</div>
                        </div>
                        <div class="responseDeclaration" identifier="ri2">
                            <div class="correctResponse" identifier="c1"></div>
                            <div class="correctResponse" identifier="c4"></div>
                        </div>
                    </div>
                    
                    <!-- Question 3 -->
					<div class="comment">DAT-1.D</div>
                    <div class="assessment-data" type="multiplechoice" identifier="Which are examples of lossless transformation?"
                        hasinlinefeedback="true" maxchoices="2" responseIdentifier="ri3" shuffle="true">
                        <div class="prompt">
                            For which of the following kinds of data would <em>lossy</em> compression be okay?  Check as many as apply.
                        </div>
                        <div class="choice" identifier="c1">
                            <div class="text">The HTML code for this web page.</div>
                            <div class="feedback">
                                Would you be happy if some of the words on the page disappeared?
                            </div>
                        </div>
                        <div class="choice" identifier="c2">
                            <div class="text">Your computer's desktop picture.</div>
                            <div class="feedback">
                                Correct.  The picture could have a few wrong pixels and would still look okay.
                            </div>
                        </div>
                        <div class="choice" identifier="c3">
                            <div class="text">A live-action movie on Netflix.</div>
                            <div class="feedback">
                                Correct.  The movie could have a few corrupted frames and would still look okay.
                            </div>
                        </div>
                        <div class="choice" identifier="c4">
                            <div class="text">A cartoon on Netflix.</div>
                            <div class="feedback">
                                Actually, corrupted frames are more noticeable in a cartoon, which has solid areas separated by sharp edges.  (Fortunately, using techniques such as run length encoding, it's relatively easy to get a lossless, highly compressed version of a cartoon.)
                            </div>
                        </div>
                        <div class="choice" identifier="c5">
                            <div class="text">A digital book, to be read on a computer.</div>
                            <div class="feedback">
                                Digital books aren't stored as pictures, but as text.  Any error will be noticeable, as gibberish characters on the page.
                            </div>
                        </div>
                        <!-- Response ID
                             Make sure each ID is unique, again!
                             Keep these classes the same for multiple choice problems
                         -->
                        <div class="responseDeclaration" identifier="ri3">
                            <div class="correctResponse" identifier="c2"></div>
                            <div class="correctResponse" identifier="c3"></div>
                        </div>
                    </div>
                    
                </li>
			</ol>
		</div>
		

	</body>
</html>
